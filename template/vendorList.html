<?php include 'vendorHead.html'; ?>
<div class="mainContainer fLeft vListPage">
        <?php include 'HeaderVendor.html'; ?>
<!--    <div class="topFixedCont">
        <div class="vndHeader fLeft">
            <div class="wrapperMax">
                <div class="vndLogo fLeft fmOpenR pointer" onclick="window.location.assign(DOMAIN);"><b>IF</b>to<b>SI</b></div>
                <div class="vndInfo fRight fmOpenR">
                    Hi, <span id="userName"></span> |
                    <div class="fRight pointer" onclick="common.doLogout();"><span>Logout</span></div>
                </div>
            </div>
        </div>
    </div>-->
    <div id='vList' class="vList fLeft">
        <div class="listHeader fLeft fmOpenR">
            <div class="fLeft headName">Vendor Name</div>
            <div class="fLeft headPackage">Package</div>
            <div class="fLeft headAmount">Amount</div>
            <div class="fLeft headExpDate">Expiry Date</div>
            <div class="fLeft headEdit">Activated</div>
        </div>
        <div class="listContainer fLeft fmOpenB font14" id="vendorLists">
        <?php
        for($i=0; $i<count($data); $i++)
        {
        ?>
            <div class="listComm fLeft fmOpenR ">
                <div class="fLeft vndName">
                   <div class="nameLocatCont fLeft txtOver hedofc" id="cn_14267019859310"><?php echo $data[$i]['orgName'];?> - <?php echo $data[$i]['city'];?></div>
                    <div class="mobileEmailCont fLeft cBlue txtOver">
                        <div class="fLeft">
                            <div class="mbIcon fLeft" id="mo_14267019859310"><?php echo $data[$i]['contact_mobile']?></div>
                            <div class="emIcon fLeft" id="em_14267019859310"><?php echo $data[$i]['email']?></div>
                        </div>
                    </div>
                </div>
                <?php
                    $cost = $data[$i]['pay_amount'];
                    $expd = explode(',',$data[$i]['business_type']);
                    
                    $arr = array();
                    for($j=0;$j<count($expd);$j++)
                    {
                        if($expd[$j] == 1)
                        {
                            $arr[] = 'Diamonds';
                        }
                        if($expd[$j] == 2)
                        {
                            $arr[] = 'Jewellery';
                        }
                        if($expd[$j] == 3)
                        {
                            $arr[] = 'Bullion';
                        }
                    }
                    $package = implode(',',$arr);
                ?>
                <div class="fLeft vndPackage txtOver"><?php echo $package?></div>
                <div class="fLeft vndAmount"><?php echo $cost?></div>
                <div class="fLeft vndExpDate" id="vndExpDate<?=$data[$i]['vendor_id'];?>"><?=$data[$i]['profile_expiry_date'];?></div>
                <div class="fLeft vndEdit">
                    <div class="toggle-button <?=($data[$i]['active_flag'] === '0') ? '' : 'toggle-button-selected';?>" onclick="changeStatus(<?=$data[$i]['vendor_id'];?>,this)">
                        <span class="fActive">Yes</span>
                        <button class="button"></button>
                        <span class="fDactive">No</span>
                    </div>
                </div>
            </div>
        <?php
        }
        ?>
        </div>
    </div>
</div>
<script type="text/javascript" src="<?=DOMAIN;?>tools/js/adminNav.js?v=<?=VERSION;?>"></script>
<script type="text/javascript" src="<?=DOMAIN;?>tools/js/Common.js?v=<?=VERSION;?>"></script>
<script type="text/javascript" src="<?= $jvs['cms_jquery_toast'];?>"></script>
<script type="text/javascript">
 var uid = customStorage.readFromStorage('userid');
    var is_vendor = customStorage.readFromStorage('is_vendor');
    var userName = customStorage.readFromStorage('name');
    $('#userName').html(userName);
    $(document).ready( function(){
        /*$('.toggle-button').on('click', function() {function
            $(this).toggleClass('toggle-button-selected');
        });*/
    });



    function changeStatus(uid,obj) {
        var st = 0;
        setTimeout(function() {
            var pLeft = $(obj).find(".button").position().left;
            if(pLeft == 0)
            {
                st = 1;
            }
            else
            {
                st = 0;
            }
            //st = pLeft;
            var URL = DOMAIN+ "index.php?action=ajx&case=updateStatus&userid=" + uid +"&af="+st;
            $.ajax({
                url: URL,
                type: 'POST',
                success: function(res) {
                    var expObj = eval('('+res+')');
                    var expiry = expObj.results.expiry;
                    if(expiry !== null && expiry !== undefined && expiry !== 'undefined' && expiry !== 'null' && expiry !== '')
                    {
                        $('#vndExpDate'+uid).text(expiry);
                    }
                    if(uid !== null)
                    {
                        var params = 'action=Vpactive&vid='+uid+'&af='+st;
                        var URL = APIDOMAIN + "index.php";

                        $.getJSON(URL, params, function(data) {
                            if(data !== null && data !== undefined && data !== '' && data !== 'null' && data !== 'undefined' && typeof data !== 'undefined')
                            {
                                if(data.error !== '' && data.error !== null && data.error !== undefined && data.error !== 'undefined' && typeof data.error !== 'undefined' && data.error.code == 0)
                                {
                                    $(obj).toggleClass('toggle-button-selected');
                                    if(st == 1)
                                    {
                                        customStorage.toast(1, 'Vendor status is changed');
                                    }
                                    else if(st == 0)
                                    {
                                        customStorage.toast(0, 'Vendor status is changed');
                                    }
                                }
                            }
                        });
                    }
             }
            });
        }, 350);
    }

    var loadProduct = true;
    var currentPage = 1;
function loadProducts(pgno) {
    $.ajax({url: APIDOMAIN + "index.php?action=vendorlist&pgno=" + pgno + "&limit=50", success: function (result) {
        loadProductsCallback(result,pgno);
    }});
}
function loadProductsCallback(res,pgno) {
    var obj = jQuery.parseJSON(res);
    if (obj['results'] != '') {
        $('#pgno').val(pgno);
        var total = obj['results']['total_vendors'];
        $('#totalProducts').text(total);
        var total_pages = obj['results']['total_vendors'];
        
        var str = '';
        if(total!=0) {
            if(total_pages==currentPage) {
                loadProduct = false;
            }
            var len = obj['results']['vendors'].length;
            var i = 0;
            while (i < len) {
                str += generateVendorsList(obj['results']['vendors'][i]);
                i++;
            }
            var html = pagination(obj,pgno);
        } else {
            str = '<div class="noRecords"><span>Sorry! No Vendors Found!</span></p>';
            loadProduct = false;
        }
        $('#vendorLists').html(str);
        $('#vendorLists').append(html)
        $('.pgComm').click(function () {
            $('.pgComm').removeClass('pgActive');
            $(this).addClass('pgActive');
            loadProducts($(this).text());
            $('html,body').animate({scrollTop: $('.listContainer').offset().top - 100}, 300);
        });
        paginationPrevNext();
    } else {
        loadProduct = false;
    }
}
        function generateVendorsList(obj) {
            var str = '<div class="listComm fLeft fmOpenR">';
            str += '<div class="fLeft vndName">';
            str += '   <div class="nameLocatCont fLeft txtOver hedofc" id="cn_14267019859310">'+obj['orgName']+' -'+obj['city']+'</div>';
            str += '    <div class="mobileEmailCont fLeft cBlue txtOver">';
            str += '        <div class="fLeft">';
            str += '            <div class="mbIcon fLeft" id="mo_14267019859310">'+obj['contact_mobile']+'</div>';
            str += '            <div class="emIcon fLeft" id="em_14267019859310">'+obj['email']+'</div>';
            str += '        </div>';
            str += '    </div>';
            str += '</div>';
            var cost=obj['pay_amount'];
            var vid = obj['vendor_id'];
            var package=new Array();
            var business_type = obj['business_type'].split(',');
            var expiry = obj.expiry_show;
            for(var j = 0; j < business_type.length; j++) {
                if(business_type[j] == 1)
                {
                    package.push('Diamonds');
                }
                if(business_type[j] == 2)
                {
                    package.push('Jewellery');
                }
                if(business_type[j] == 3)
                {
                    package.push('Bullion');
                }
            }
            
            str += '<div class="fLeft vndPackage">'+package.join()+'</div>';
            str += '<div class="fLeft vndAmount">'+cost+'</div>';
            str += '<div class="fLeft vndExpDate" id="vndExpDate'+vid+'">'+expiry+'</div>';
            str += '<div class="fLeft vndEdit">';
            var className='';
            if(obj['active_flag']=='1'){
                className='toggle-button-selected';
            }
            str += '    <div class="toggle-button '+className+'" onclick="changeStatus('+obj['vendor_id']+',this)">';
            str += '        <span class="fActive">Yes</span>';
            str += '        <button class="button"></button>';
            str += '        <span class="fDactive">No</span>';
            str += '    </div>';
            str += '</div>';
            str += '</div>';
            return str;
        }

        function pagination(data, pgno) {
            /* For Pagintion */
            pgno = pgno * 1;
            var html = '';
            var tc = data.results.total_vendors;
            var lastpg = Math.ceil(tc / 50);
            var adjacents = 2;
            $('#total_pageno').val(lastpg);
            if (lastpg > 1)
            {
                html += '<div class="fLeft pagination fmOpenR">';
                html += '<center>';
                html += '<div class="pPrev poR ripplelink">Previous</div>';
                if (lastpg < 7 + (adjacents * 2))
                {
                    for (var i = 1; i <= lastpg; i++)
                    {
                        if (i == pgno)
                        {
                            html += '<div class="pgComm poR ripplelink pgActive">' + i + '</div>';
                        }
                        else
                        {
                            html += '<div class="pgComm poR ripplelink">' + i + '</div>';
                        }
                    }
                }
                else if (lastpg > 5 + (adjacents * 2))
                {
                    if (pgno < 1 + (adjacents * 2))
                    {
                        for (var i = 1; i < 4 + (adjacents * 2); i++)
                        {
                            if (i == pgno)
                            {
                                html += '<div class="pgComm poR ripplelink pgActive">' + i + '</div>';
                            }
                            else
                            {
                                html += '<div class="pgComm poR ripplelink">' + i + '</div>';
                            }
                        }
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgComm poR ripplelink">' + lastpg + '</div>';
                    }
                    else if (lastpg - (adjacents * 2) > pgno && pgno > (adjacents * 2))
                    {
                        html += '<div class="pgComm poR ripplelink">1</div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        for (var i = pgno - adjacents; i <= pgno + adjacents; i++)
                        {
                            if (i == pgno)
                            {
                                html += '<div class="pgComm poR ripplelink pgActive">' + i + '</div>';
                            }
                            else
                            {
                                html += '<div class="pgComm poR ripplelink">' + i + '</div>';
                            }
                        }
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgComm poR ripplelink">' + lastpg + '</div>';
                    }
                    else
                    {
                        html += '<div class="pgComm poR ripplelink">1</div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        html += '<div class="pgEmpty"></div>';
                        for (var i = lastpg - (2 + (adjacents * 2)); i <= lastpg; i++)
                        {
                            if (i == pgno)
                            {
                                html += '<div class="pgComm poR ripplelink pgActive">' + i + '</div>';
                            }
                            else
                            {
                                html += '<div class="pgComm poR ripplelink">' + i + '</div>';
                            }
                        }
                    }
                }
                html += '<div class="pNext poR ripplelink">Next</div>';
                html += '</center>';
                html += '</div>';
            }
            return html;
        }

function paginationPrevNext()
{
    $('.pPrev').bind('click', function() {
        
            var curpgno = parseInt($('#pgno').val());
                var pgval = curpgno - 1;
		if(curpgno > 1)
		{
			$('#pgno').val(pgval);
			if(pageName.indexOf("vendorList") !== -1)
			{
				/*if(typeof $('.productstab') !== 'undefined')
				{
					$(".productstab").each(function(){
						if($(this).hasClass('sel'))
						{
							loadProducts($(this).attr('id'),pgval);
						}
					});
				}*/
                                loadProducts(pgval);
			}
			else
			{   
				loadProducts(1);
			}
		}
            });
            	$('.pNext').bind('click', function() {
		var curpgno = parseInt($('#pgno').val());
		var pgval = curpgno + 1;
		if(curpgno < parseInt($('#total_pageno').val()))
		{
			$('#pgno').val(pgval);
			if(pageName.indexOf("vendorList") !== -1)
			{
				/*if(typeof $('.wishTabComm') !== 'undefined')
				{
					$(".productstab").each(function(){
						if($(this).hasClass('sel'))
						{
							loadProducts($(this).attr('id'),pgval);
						}
					});
				}*/
                                loadProducts(pgval);
			}
			else
			{
				loadProducts(1);
			}
		}
	});
}
    loadProducts(1);
        $('.pPrev').bind('click', function() {

            var curpgno = parseInt($('#pgno').val());
            	var pgval = curpgno - 1;
		if(curpgno > 1)
		{
			$('#pgno').val(pgval);
			if(pageName.indexOf("vendorList") !== -1)
			{
				/*if(typeof $('.productstab') !== 'undefined')
				{
					$(".productstab").each(function(){
						if($(this).hasClass('sel'))
						{
							loadProducts($(this).attr('id'),pgval);
						}
					});
				}*/
                                loadProducts(pgval);
			}
			else
			{   
				loadProducts(1);
			}
		}
	});

	$('.pNext').bind('click', function() {
		var curpgno = parseInt($('#pgno').val());
		var pgval = curpgno + 1;
		if(curpgno < parseInt($('#total_pageno').val()))
		{
			$('#pgno').val(pgval);
			
			if(pageName.indexOf("vendorList") !== -1)
			{
				/*if(typeof $('.wishTabComm') !== 'undefined')
				{
					$(".productstab").each(function(){
						if($(this).hasClass('sel'))
						{
							loadProducts($(this).attr('id'),pgval);
						}
					});
				}*/
                                loadProducts(pgval);
			}
			else
			{
				loadProducts(1);
			}
		}
	});
</script>
</body>
</html>
